# n8n-nodes-jimengai

[![English](https://img.shields.io/badge/English-Click-yellow)](README.md)
[![中文文档](https://img.shields.io/badge/中文文档-点击查看-orange)](README-zh.md)

> 将即梦图像/视频生成能力无缝接入 n8n，实现可视化 AI 内容创作工作流。

---

### 🧩 插件简介

`n8n-nodes-jimengai` 是一个基于即梦的 n8n 插件，支持 **图片生成** 与 **视频生成** 两个核心操作节点，允许用户通过流程化自动化方式，完成高质量的 AIGC 图像/视频创作任务。

[n8n](https://n8n.io/) 是一个[公平代码许可](https://docs.n8n.io/reference/license/)的工作流自动化平台。

[快速开始](#快速开始)  
[核心功能](#核心功能)  
[适用场景](#适用场景)  
[鉴权方式](#鉴权方式)  
[兼容性](#兼容性)  
[资源](#资源)  

## 快速开始

1. 在 n8n 中安装插件：

   ```bash
   npm install n8n-nodes-jimengai
   ```

2. 在编辑器中拖入 "Jimeng" 节点。

3. 选择资源类型：
   - **Image**：图片生成（文生图2.1/3.0/3.1/4.0、图生图3.0）
   - **Video**：视频生成（文生视频、图生视频、动作模仿、数字人视频等）

4. 选择具体操作：
   - 图片生成：文生图2.1、文生图3.0、文生图3.1、文生图4.0、图生图3.0、各类结果查询
   - 视频生成：文生视频720P/1080P、图生视频720P/1080P、动作模仿、视频生成3.0 Pro、数字人视频生成等
   - 数字人功能：人体检测、数字人视频生成、数字人结果查询等
   - 状态查询：各类图片结果查询、视频结果查询、数字人结果查询等

5. 配置认证信息：
   - AccessKeyID
   - SecretAccessKey
   - Region（区域）

   **注意**：认证配置时可能不会显示"Connection tested successfully"提示，这是正常现象。认证会在实际API调用时进行验证。

6. 填入参数，开始生成。

7. **异步任务处理**：
   - 对于异步接口（文生图3.0/3.1/4.0、所有视频生成、数字人功能），会返回任务ID
   - 使用对应的状态查询接口定期检查任务状态
   - 任务完成后获取生成的图像、视频或数字人内容

8. 可配合其他节点（如：OpenAI、Notion、Telegram、Drive 等）构建完整自动化流程。

## 核心功能

### ✨ 图片生成（Image Generation）
- **文生图2.1**：基于文本描述生成高质量图像（同步接口）
- **文生图3.0**：使用即梦3.0模型进行文本到图像生成（异步接口）
- **文生图3.1**：使用即梦3.1模型进行文本到图像生成（异步接口）
- **文生图4.0**：使用即梦4.0模型进行高级图像生成（异步接口）
- **图生图3.0**：基于现有图像和文本提示生成新图像（异步接口）
- **结果查询**：文生图3.0结果查询、文生图3.1结果查询、文生图4.0结果查询、图生图3.0结果查询
- **多模型支持**：jimeng-2.1, jimeng-3.0, jimeng-3.1, jimeng-4.0
- **灵活尺寸**：支持多种宽高比（21:9, 16:9, 3:2, 4:3, 1:1, 3:4, 2:3, 9:16）
- **高级功能**：多图输入、智能尺寸设置、宽高比约束、强制单图生成
- **水印设置**：支持自定义水印文本、位置、透明度等
- **AIGC元数据**：支持内容生产者、传播者等元数据设置
- **异步处理**：可选择等待生成完成或异步处理

### 🤖 数字人功能（Digital Human）
- **人体检测**：检测图像中是否包含人体主体，为数字人创建做准备
- **数字人视频生成**：基于图像和音频生成数字人视频（MP4格式）
- **结果查询**：数字人视频生成结果查询、人体检测结果查询
- **多格式输出**：支持Base64、二进制数据、文件保存等多种输出格式
- **本地缓存**：支持视频文件本地缓存，提高重复使用效率
- **智能检测**：自动检测图像中的人体主体，确保数字人生成质量
- **音频同步**：支持音频与视频的精确同步，推荐15秒内音频
- **异步处理**：支持异步任务提交和状态查询

### 🎬 视频生成（Video Generation）
- **文生视频720P**：通过文本描述生成720P视频
- **文生视频1080P**：通过文本描述生成1080P视频
- **图生视频720P-首帧**：基于图像首帧生成720P视频
- **图生视频720P-首尾帧**：基于图像首尾帧生成720P视频
- **图生视频720P-运镜**：基于图像和运镜效果生成720P视频
- **图生视频1080P-首帧**：基于图像首帧生成1080P视频
- **图生视频1080P-首尾帧**：基于图像首尾帧生成1080P视频
- **视频生成3.0 Pro**：使用Pro模型生成高质量视频
- **动作模仿**：基于参考视频进行动作模仿生成
- **视频结果查询**：实时查询各类视频生成任务状态和结果
- **灵活参数**：支持多种宽高比和时长设置（1-10秒）
- **异步处理**：可选择等待生成完成或异步处理

## 已实现的API接口

### 📸 图片生成接口（9个）
| 接口名称 | 文件路径 | 模型版本 | 功能描述 | 测试 |
|---------|---------|---------|---------|---------|
| 文生图2.1 | `TextToImageOperate.ts` | jimeng-2.1 | 根据文本描述生成高质量图像（同步） | 成功 |
| 文生图3.0 | `TextToImage30Operate.ts` | jimeng-3.0 | 使用3.0模型进行文本到图像生成（异步） | 成功 |
| 文生图3.1 | `TextToImage31Operate.ts` | jimeng-3.1 | 使用3.1模型进行文本到图像生成（异步） | 成功 |
| 文生图4.0 | `ImageGeneration40Operate.ts` | jimeng-4.0 | 使用4.0模型进行高级图像生成，支持多图输入（异步） | 成功 |
| 图生图3.0 | `ImageToImageOperate.ts` | jimeng-3.0 | 基于现有图像和文本提示生成新图像（异步） | 成功 |
| 文生图3.0结果 | `TextToImage30ResultOperate.ts` | - | 查询文生图3.0任务结果 | 成功 |
| 文生图3.1结果 | `TextToImage31ResultOperate.ts` | - | 查询文生图3.1任务结果 | 成功 |
| 文生图4.0结果 | `ImageGeneration40ResultOperate.ts` | - | 查询文生图4.0任务结果 | 成功 |
| 图生图3.0结果 | `ImageToImage30ResultOperate.ts` | - | 查询图生图3.0任务结果 | 成功 |

### 🎬 视频生成接口（18个）
| 接口名称 | 文件路径 | 模型版本 | 功能描述 | 测试 |
|---------|---------|---------|---------|---------|
| 文生视频720P | `TextToVideo720POperate.ts` | video-3.0-720p | 根据文本描述生成720P视频 | 成功 |
| 文生视频1080P | `TextToVideo1080POperate.ts` | video-3.0-1080p | 根据文本描述生成1080P视频 | 成功 |
| 图生视频720P-首帧 | `ImageToVideo720PFirstFrameOperate.ts` | video-3.0-720p | 基于图像首帧生成720P视频 | 成功 |
| 图生视频720P-首尾帧 | `ImageToVideo720PFirstLastFrameOperate.ts` | video-3.0-720p | 基于图像首尾帧生成720P视频 | 成功 |
| 图生视频720P-运镜 | `ImageToVideo720PCameraMotionOperate.ts` | video-3.0-720p | 基于图像和运镜效果生成720P视频 | 成功 |
| 图生视频1080P-首帧 | `ImageToVideo1080PFirstFrameOperate.ts` | video-3.0-1080p | 基于图像首帧生成1080P视频 | 成功 |
| 图生视频1080P-首尾帧 | `ImageToVideo1080PFirstLastFrameOperate.ts` | video-3.0-1080p | 基于图像首尾帧生成1080P视频 | 成功 |
| 视频生成3.0 Pro | `VideoGeneration30ProOperate.ts` | video-3.0-pro | 使用Pro模型生成高质量视频 | 成功 |
| 动作模仿 | `ActionImitationOperate.ts` | action-imitation | 基于参考视频进行动作模仿生成 | 成功 |
| 文生视频720P结果 | `TextToVideo720PResultOperate.ts` | - | 查询文生视频720P任务结果 | 成功 |
| 文生视频1080P结果 | `TextToVideo1080PResultOperate.ts` | - | 查询文生视频1080P任务结果 | 成功 |
| 图生视频720P-首帧结果 | `ImageToVideo720PFirstFrameResultOperate.ts` | - | 查询图生视频720P-首帧任务结果 | 成功 |
| 图生视频720P-首尾帧结果 | `ImageToVideo720PFirstLastFrameResultOperate.ts` | - | 查询图生视频720P-首尾帧任务结果 | 成功 |
| 图生视频720P-运镜结果 | `ImageToVideo720PCameraMotionResultOperate.ts` | - | 查询图生视频720P-运镜任务结果 | 成功 |
| 图生视频1080P-首帧结果 | `ImageToVideo1080PFirstFrameResultOperate.ts` | - | 查询图生视频1080P-首帧任务结果 | 成功 |
| 图生视频1080P-首尾帧结果 | `ImageToVideo1080PFirstLastFrameResultOperate.ts` | - | 查询图生视频1080P-首尾帧任务结果 | 成功 |
| 视频生成3.0 Pro结果 | `VideoGeneration30ProResultOperate.ts` | - | 查询视频生成3.0 Pro任务结果 | 成功 |
| 动作模仿结果 | `ActionImitationResultOperate.ts` | - | 查询动作模仿任务结果 | 成功 |

### 🤖 数字人功能接口（4个）
| 接口名称 | 文件路径 | 模型版本 | 功能描述 | 测试 |
|---------|---------|---------|---------|---------|
| 人体检测 | `HumanSubjectDetectionOperate.ts` | - | 检测图像中是否包含人体主体 | 成功 |
| 人体检测结果 | `HumanSubjectDetectionResultOperate.ts` | - | 查询人体检测任务结果 | 成功 |
| 数字人视频生成 | `HumanVideoGenerationOperate.ts` | digital-human | 基于图像和音频生成数字人视频 | 成功 |
| 数字人视频生成结果 | `HumanVideoGenerationResultOperate.ts` | - | 查询数字人视频生成任务结果 | 成功 |

## 功能特性

### 🎯 核心操作
| 功能类型 | 操作名称 | 描述 | 支持模型 |
|---------|---------|------|---------|
| **图像生成** | 文生图2.1 | 根据文本描述生成图像（同步） | jimeng-2.1 |
| | 文生图3.0 | 使用3.0模型进行文本到图像生成（异步） | jimeng-3.0 |
| | 文生图3.1 | 使用3.1模型进行文本到图像生成（异步） | jimeng-3.1 |
| | 文生图4.0 | 使用4.0模型进行高级图像生成（异步） | jimeng-4.0 |
| | 图生图3.0 | 基于现有图像和文本提示生成新图像（异步） | jimeng-3.0 |
| | 文生图3.0结果 | 查询文生图3.0任务结果 | - |
| | 文生图3.1结果 | 查询文生图3.1任务结果 | - |
| | 文生图4.0结果 | 查询文生图4.0任务结果 | - |
| | 图生图3.0结果 | 查询图生图3.0任务结果 | - |
| **视频生成** | 文生视频720P | 根据文本描述生成720P视频 | video-3.0-720p |
| | 文生视频1080P | 根据文本描述生成1080P视频 | video-3.0-1080p |
| | 图生视频720P-首帧 | 基于图像首帧生成720P视频 | video-3.0-720p |
| | 图生视频720P-首尾帧 | 基于图像首尾帧生成720P视频 | video-3.0-720p |
| | 图生视频720P-运镜 | 基于图像和运镜效果生成720P视频 | video-3.0-720p |
| | 图生视频1080P-首帧 | 基于图像首帧生成1080P视频 | video-3.0-1080p |
| | 图生视频1080P-首尾帧 | 基于图像首尾帧生成1080P视频 | video-3.0-1080p |
| | 视频生成3.0 Pro | 使用Pro模型生成高质量视频 | video-3.0-pro |
| | 动作模仿 | 基于参考视频进行动作模仿生成 | action-imitation |
| **数字人功能** | 人体检测 | 检测图像中是否包含人体主体 | - |
| | 数字人视频生成 | 基于图像和音频生成数字人视频 | digital-human |
| | 人体检测结果 | 查询人体检测任务结果 | - |
| | 数字人视频生成结果 | 查询数字人视频生成任务结果 | - |
| **状态查询** | 各类视频结果查询 | 查询各类视频生成任务状态和结果 | - |

### ⚙️ 参数配置
- **图像尺寸**：支持自定义宽度和高度，多种宽高比（21:9, 16:9, 3:2, 4:3, 1:1, 3:4, 2:3, 9:16）
- **高级图像设置**：区域面积设置、宽高比约束、多图输入（最多10张）、强制单图生成
- **视频时长**：1-10秒可调（根据模型支持）
- **视频分辨率**：720P、1080P、自定义分辨率（Pro模型）
- **图像风格**：动漫、油画、写实、素描、水彩等
- **运镜效果**：平移、倾斜、缩放等多种运镜方式
- **生成参数**：步数、引导比例、随机种子、文本影响度等
- **水印设置**：自定义水印文本、位置（四角）、透明度、语言（中英文）
- **AIGC元数据**：内容生产者、传播者、唯一标识等元数据配置
- **数字人配置**：图像URL、音频URL、输出格式、本地缓存设置
- **文件输出**：支持Base64、二进制、文件保存、缓存等多种输出格式
- **生成模式**：同步等待或异步处理
- **模型选择**：多种即梦AI模型可选（包括jimeng-4.0、digital-human等）

## 适用场景

### 🧠 AIGC 内容创作
- **自动化内容生产**：批量生成图文日报、资讯内容
- **营销素材制作**：自动创作营销图/短视频工作流
- **创意内容制作**：AIGC 创意剧本 + 分镜 + 视频一体化解决方案
- **电商应用**：产品图自动生成（结合商品描述和参数）
- **数字人应用**：虚拟主播、教学视频、客服机器人、个性化播报
- **多媒体制作**：图文音视频一体化内容生产流水线

### 🔄 工作流集成
- **多平台发布**：结合 Telegram、Discord 等节点实现自动发布
- **数据驱动**：结合 Notion、Airtable 等数据源节点
- **条件判断**：结合 IF 节点实现智能内容筛选
- **定时触发**：结合 Cron 节点实现定时内容生成

## 异步处理模式

### 🔄 同步 vs 异步接口

#### 同步接口（立即返回结果）
- **文生图2.1**：提交任务后立即返回生成的图像
- 适用于快速生成需求，无需等待时间

#### 异步接口（需要状态查询）
- **文生图3.0/3.1/4.0**：提交任务后返回任务ID，需要定期查询状态
- **图生图3.0**：提交任务后返回任务ID，需要定期查询状态
- **所有视频生成接口**：提交任务后返回任务ID，需要定期查询结果
- **数字人功能接口**：人体检测、数字人视频生成均为异步接口
- 适用于高质量生成需求，生成时间较长

### 📋 异步处理工作流

1. **提交生成任务**：使用相应的生成接口提交任务
2. **获取任务ID**：记录返回的任务ID
3. **状态查询**：使用对应的结果查询接口定期检查任务状态
   - 图片生成：文生图3.0结果、文生图3.1结果、文生图4.0结果、图生图3.0结果
   - 视频生成：各类视频结果查询接口
   - 数字人功能：人体检测结果、数字人视频生成结果
4. **获取结果**：任务完成后获取生成的图像、视频或数字人内容
5. **可选配置**：在结果查询时可配置水印、AIGC元数据、输出格式等

### ⏱️ 任务状态说明

- **pending**：任务已提交，等待处理
- **processing**：任务正在处理中
- **completed**：任务完成，可以获取结果
- **failed**：任务失败，查看错误信息

### 🔍 结果查询功能

#### 图片结果查询特性
- **水印设置**：支持添加自定义水印，可选择位置、透明度、语言
- **AIGC元数据**：支持设置内容生产者、传播者等元数据信息
- **多种返回格式**：支持返回图片URL（24小时有效）或Base64编码数据
- **状态监控**：实时监控任务进度和完成状态

#### 视频结果查询特性
- **多分辨率支持**：720P、1080P等多种分辨率结果查询
- **多生成模式**：文生视频、图生视频、动作模仿等结果查询
- **状态监控**：实时监控视频生成进度和完成状态

#### 数字人结果查询特性
- **人体检测结果**：返回图像中人体主体检测状态，支持多种输出格式
- **数字人视频结果**：支持多种输出格式（URL、Base64、二进制、文件保存）
- **本地缓存支持**：支持视频文件本地缓存，提高重复使用效率
- **智能缓存管理**：支持自定义缓存键、MD5计算、缓存目录配置
- **多格式输出**：支持MP4、WebM、AVI等多种视频格式
- **状态监控**：实时监控数字人生成进度和完成状态

## 技术架构

### 🏗️ 模块化设计
- **资源构建器**：`ResourceBuilder` 动态加载图像和视频资源模块
- **API客户端**：`JimengApiClient` 封装即梦API交互逻辑
- **操作模块**：独立的图像/视频操作实现，支持扩展
- **工具类**：模块加载、节点工具、请求工具等辅助功能

### 🔧 核心特性
- **类型安全**：完整的 TypeScript 类型定义
- **错误处理**：完善的错误处理和日志记录机制
- **异步支持**：支持同步和异步生成模式
- **状态管理**：实时任务状态查询和监控

## 鉴权方式

### 🔐 使用即梦 API 认证信息

本插件通过即梦API的 `AccessKeyID` 和 `SecretAccessKey` 实现鉴权。

#### ✅ 获取认证信息方法：

1. 访问 [即梦官网](https://jimeng.jianying.com/) 并登录账号；
2. 进入API管理页面，创建或获取API密钥；
3. 复制 `AccessKeyID` 和 `SecretAccessKey` 值；
4. 在 n8n 节点配置中填入认证信息，即可完成授权。

#### 🔒 安全说明
- 请妥善保管您的认证信息，避免泄露
- 建议定期轮换API密钥以确保安全
- 建议在测试环境中先验证认证有效性
- 认证信息具有时效性，需要定期更新

## 故障排除

### ❌ 认证配置问题

**问题**：在n8n中配置Jimeng Credentials时出现"Couldn't connect with these settings"或"Bad request - please check your parameters"错误，无法看到"Connection tested successfully"提示。

**原因**：火山引擎即梦API的认证测试端点需要特定权限，普通用户可能无法访问测试端点。

**解决方案**：
1. **忽略认证测试错误**：这是正常现象，认证会在实际API调用时进行验证
2. **直接使用节点**：配置好认证信息后，直接使用Jimeng节点进行图像或视频生成
3. **验证认证信息**：确保AccessKeyID、SecretAccessKey和Region配置正确
4. **检查权限**：确保您的即梦账户有相应的API调用权限

**验证方法**：
- 尝试运行一个简单的图像生成任务
- 如果任务成功执行，说明认证配置正确
- 如果任务失败，请检查认证信息是否正确

## 兼容性

- **最低n8n版本**: 1.0.0
- **Node.js版本**: >=22.16
- **测试版本**: n8n 1.0.0+

## 资源

* [n8n社区节点文档](https://docs.n8n.io/integrations/#community-nodes)
* [即梦官网](https://jimeng.jianying.com/)
* [n8n工作流模板](https://github.com/crazyyanchao/n8n-workflow-template)

---

**注意**: 使用此节点需要有效的即梦账户和相应的API权限。请确保遵守即梦的使用条款和API调用限制。
